<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
  font: 10px sans-serif;
}

</style>
<link rel="stylesheet" type="text/css" href="css/style.css">
<body>
  <div id="content">
    <h1>Sensoree EEG Graph</h1>
    <div class="row">
      <div class="col-md-2">
        <h3>Tune In</h3>
        <div id="bubble1"></div>
      </div>
      <div class="col-md-2">
        <h3>Stimulate</h3>
        <div id="bubble2"></div>
      </div>
      <div class="col-md-2">
        <h3>Relax</h3>
        <div id="bubble3"></div>
      </div>
      <div class="col-md-2">
        <h3>Sensate</h3>
        <div id="bubble4"></div>
      </div>
      <div class="col-md-2">
        <h3>Essence</h3>
        <div id="bubble5"></div>
      </div>
    </div>

    <div class="row">
      NeurotiQ States:
    </div>

  </div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
<script>

var diameter = 960;

var svg = d3.select('#bubble1').append('svg')
  .attr('width', diameter)
  .attr('height', diameter);

var bubble = d3.layout.pack()
  .size([diameter, diameter])
  .padding(3)
  .value(function(d) {return d.size;})

d3.json("data/data.json", function(error, data) {
  // console.log(data)
  var nodes = bubble.nodes(processData(data))
    .filter(function(d) { return !d.children; }); // filter out the outer bubble

    console.log(nodes)
  var vis = svg.selectAll('circle')
    .data(nodes, function(d) { return d.name; });

  vis.enter().append('circle')
    .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; })
    .attr('r', function(d) { return d.r; })
    .attr('class', function(d) { return d.className; });

});


function processData(data) {
  // { "name": 1, "children": [{"name": theta, "size": 0.45}, {"name": theta, "size": 0.45} ]}
  var obj = data.mentalState;
  var childrenArr = [];

  for(var prop in obj) {
    var newArr = [];
    for(var item in obj[prop]) {
      newArr.push({name: item, size: obj[prop][item], className: item.toLowerCase()})
    }
    childrenArr.push({name: prop, children: newArr})
  }

  return {children: childrenArr};
}

d3.select(self.frameElement).style("height", diameter + "px");

</script>